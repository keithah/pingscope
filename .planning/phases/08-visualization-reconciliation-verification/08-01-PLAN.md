---
phase: 08-visualization-reconciliation-verification
plan: 01
type: execute
wave: 1
depends_on: ["07-04"]
files_modified:
  - Sources/PingScope/Views/DisplayGraphView.swift
  - Sources/PingScope/Views/FullModeView.swift
  - Sources/PingScope/Views/RecentResultsListView.swift
  - Sources/PingScope/ViewModels/DisplayViewModel.swift
  - Tests/PingScopeTests/DisplayViewModelTests.swift
  - .planning/phases/05-visualization/05-visualization-VERIFICATION.md
  - .planning/REQUIREMENTS.md
autonomous: false

must_haves:
  truths:
    - "In full mode, users see a live graph with line, gradient fill, and per-sample points for the selected host (VIS-01, VIS-02)"
    - "Changing the time range (1m/5m/10m/1h) updates both graph and history windows to the selected interval (VIS-03)"
    - "History is scrollable, newest-first, and each row visibly separates timestamp, host, ping time, and status (VIS-04, VIS-05)"
    - "Users see transmitted/received/packet-loss and min/avg/max/stddev values update coherently with incoming samples (VIS-06, VIS-07)"
    - "Verification and traceability docs include per-VIS pass/fail evidence, and VIS-01..VIS-07 are marked Complete only after that evidence is recorded"
  artifacts:
    - path: "Sources/PingScope/Views/FullModeView.swift"
      provides: "Visualization shell wiring for graph, filter, history, and stats surfaces"
      contains: "DisplayGraphView|time range menu|history table header"
    - path: "Sources/PingScope/Views/RecentResultsListView.swift"
      provides: "Recent-first scrollable history rows with explicit ping-time and status rendering"
      contains: "ScrollView|LazyVStack|row fields"
    - path: ".planning/phases/05-visualization/05-visualization-VERIFICATION.md"
      provides: "Audit-grade VIS-01..VIS-07 verification evidence"
      contains: "Observable Truths|Required Artifacts|Requirements Coverage"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Traceability status for VIS-01..VIS-07"
      contains: "| VIS-01 | Phase 5 | Complete |"
  key_links:
    - from: "Sources/PingScope/Views/FullModeView.swift"
      to: "Sources/PingScope/Views/DisplayGraphView.swift"
      via: "Graph surface wiring for selected host points"
      pattern: "DisplayGraphView\\(points:"
    - from: "Sources/PingScope/ViewModels/DisplayViewModel.swift"
      to: "Sources/PingScope/Views/RecentResultsListView.swift"
      via: "Recent-first rows projection consumed by history UI"
      pattern: "selectedHostRecentRows|reversed\\(\\)"
    - from: ".planning/phases/05-visualization/05-visualization-VERIFICATION.md"
      to: ".planning/REQUIREMENTS.md"
      via: "Only mark VIS rows Complete after evidence is recorded"
      pattern: "VIS-0[1-7]"
---

<objective>
Reconcile all visualization requirements (VIS-01..VIS-07) with real implementation, close any concrete gaps, and publish missing Phase 5 verification evidence.

Purpose: Milestone audit is currently blocked by pending VIS traceability and the missing Phase 5 verification artifact; this plan closes both with evidence-backed validation.
Output: Any required visualization gap fixes (with VIS-04 ambiguity resolved), `.planning/phases/05-visualization/05-visualization-VERIFICATION.md`, and VIS rows marked `Complete` in `.planning/REQUIREMENTS.md`.
</objective>

<execution_context>
@/Users/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/v1.0-v1.0-MILESTONE-AUDIT.md
@.planning/phases/08-visualization-reconciliation-verification/08-RESEARCH.md
@.planning/phases/05-visualization/05-01-SUMMARY.md
@.planning/phases/05-visualization/05-02-SUMMARY.md
@.planning/phases/05-visualization/05-03-SUMMARY.md

@Sources/PingScope/Views/DisplayGraphView.swift
@Sources/PingScope/ViewModels/DisplayViewModel.swift
@Sources/PingScope/Views/FullModeView.swift
@Sources/PingScope/Views/RecentResultsListView.swift
@Tests/PingScopeTests/DisplayViewModelTests.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reconcile VIS-01..VIS-07 in code and close any implementation gaps</name>
  <files>
    Sources/PingScope/Views/DisplayGraphView.swift
    Sources/PingScope/Views/FullModeView.swift
    Sources/PingScope/Views/RecentResultsListView.swift
    Sources/PingScope/ViewModels/DisplayViewModel.swift
    Tests/PingScopeTests/DisplayViewModelTests.swift
  </files>
  <action>
Build a strict requirement-to-code reconciliation matrix and implement only confirmed mismatches. Map each VIS requirement to concrete implementation work:
- VIS-01 (graph rendering): ensure full mode renders `DisplayGraphView` with selected-host points via `DisplayGraphView(points:` wiring in `FullModeView.swift`.
- VIS-02 (visual treatment): ensure graph keeps line + gradient fill + per-sample points in `DisplayGraphView.swift`; if any element is missing, restore it without redesign.
- VIS-03 (time filters): ensure 1m/5m/10m/1h selection updates graph and history input windows consistently through existing view model flow.
- VIS-04 (history field explicitness): ensure each history row shows timestamp, host, ping time, and status as distinct visible fields (no conflated ping/status cell).
- VIS-05 (recent-first history): preserve newest-first ordering and scrollability, sourced from `DisplayViewModel` projection used by `RecentResultsListView`.
- VIS-06 and VIS-07 (stats block): keep transmitted/received/packet-loss plus min/avg/max/stddev visible and fed by live sample updates.

Operationalize must-have key links during this task:
- Implement/confirm graph wiring link: `FullModeView.swift` -> `DisplayGraphView.swift` (`DisplayGraphView(points:`).
- Implement/confirm recent-row wiring link: `DisplayViewModel.swift` -> `RecentResultsListView.swift` (`selectedHostRecentRows` / recent-first transformation).

Add or adjust targeted tests in `DisplayViewModelTests.swift` only where needed to lock ordering/stat derivation behavior introduced by fixes. Do not add dependencies or perform broad UI redesign.
  </action>
  <verify>
Run and record all checks:
- `swift build`
- `swift test --filter DisplayViewModelTests`
- `rg "DisplayGraphView\\(points:" Sources/PingScope/Views/FullModeView.swift`
- `rg "selectedHostRecentRows|reversed\\(\\)" Sources/PingScope/ViewModels/DisplayViewModel.swift Sources/PingScope/Views/RecentResultsListView.swift`
- `rg -i "timestamp|host|ping|status" Sources/PingScope/Views/RecentResultsListView.swift`
  </verify>
  <done>
VIS-01..VIS-07 each have explicit code-level coverage notes tied to concrete files, all confirmed mismatches are fixed, and key links 1-2 are implemented and command-verified.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Runtime-validated visualization behavior for VIS-01 through VIS-07 after reconciliation fixes</what-built>
  <how-to-verify>
1) Launch app in full mode and select a host with active pings.
2) Verify graph behavior (VIS-01/02): line is visible, gradient fill is visible, and per-ping points are visible while values update.
3) Verify time filter behavior (VIS-03): switch 1m/5m/10m/1h and confirm graph/history windows change accordingly.
4) Verify history table fields (VIS-04/05): recent results list is scrollable, newest first, and each row clearly shows timestamp, host, ping time, and status as separate fields.
5) Verify statistics (VIS-06/07): transmitted/received/packet-loss plus min/avg/max/stddev display and update coherently with incoming samples.
6) If any requirement is unclear/failing, record exact mismatch so Task 3 evidence reports it accurately.
  </how-to-verify>
  <resume-signal>Type "approved" if all VIS checks pass, or provide failing requirement IDs with observed behavior.</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Publish Phase 5 verification artifact and close VIS traceability</name>
  <files>
    .planning/phases/05-visualization/05-visualization-VERIFICATION.md
    .planning/REQUIREMENTS.md
  </files>
  <action>
Create `.planning/phases/05-visualization/05-visualization-VERIFICATION.md` in the established verifier format (frontmatter + observable truths + required artifacts + requirements coverage + gaps summary) and include explicit VIS requirement mapping:
- VIS-01..VIS-07 each get one row with: code evidence (Task 1), runtime evidence (Task 2), status, and any gap note.
- Add a "Key Link Evidence" subsection with command outputs/evidence for all declared links:
  1) `FullModeView.swift` -> `DisplayGraphView.swift` pattern `DisplayGraphView(points:`
  2) `DisplayViewModel.swift` -> `RecentResultsListView.swift` pattern `selectedHostRecentRows|reversed()`
  3) Verification artifact -> `REQUIREMENTS.md` VIS-01..VIS-07 traceability update ordering

After the verification artifact is complete (not before), update `.planning/REQUIREMENTS.md` rows for VIS-01..VIS-07 from `Pending` to `Complete`.

Document that full global `swift test` remains a known Phase 9 dependency; use targeted visualization verification outputs as this phase's acceptance evidence.
  </action>
  <verify>
Run and record all checks:
- `test -f .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
- `rg "VIS-0[1-7]" .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
- `rg "DisplayGraphView\\(points:|selectedHostRecentRows|reversed\\(\\)" .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
- `[[ $(rg -c "^\| VIS-0[1-7] \| Phase 5 \| Complete \|" .planning/REQUIREMENTS.md) -eq 7 ]]`
  </verify>
  <done>
Phase 5 verification artifact exists with explicit VIS-01..VIS-07 mapping, key-link evidence, and runtime acceptance evidence; `REQUIREMENTS.md` contains exactly seven `Complete` VIS rows updated after artifact creation.
  </done>
</task>

</tasks>

<verification>
- `swift build`
- `swift test --filter DisplayViewModelTests`
- `rg "DisplayGraphView\(points:" Sources/PingScope/Views/FullModeView.swift`
- `rg "selectedHostRecentRows|reversed\(\)" Sources/PingScope/ViewModels/DisplayViewModel.swift Sources/PingScope/Views/RecentResultsListView.swift`
- Runtime human verification checkpoint for VIS-01..VIS-07
- Verify artifact and traceability updates:
  - `test -f .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
  - `rg "VIS-0[1-7]" .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
  - `rg "DisplayGraphView\(points:|selectedHostRecentRows|reversed\(\)" .planning/phases/05-visualization/05-visualization-VERIFICATION.md`
  - `[[ $(rg -c "^\| VIS-0[1-7] \| Phase 5 \| Complete \|" .planning/REQUIREMENTS.md) -eq 7 ]]`
- Note in verification artifact: full `swift test` remains a known Phase 9 dependency and is out of scope for Phase 8 acceptance.
</verification>

<success_criteria>
- VIS-01..VIS-07 are explicitly mapped at task level and reconciled with no unresolved implementation ambiguity (including explicit VIS-04 field representation).
- Human runtime verification confirms user-observable behavior for graph rendering, time filtering, history field separation/recent-first ordering, and stats updates.
- `.planning/phases/05-visualization/05-visualization-VERIFICATION.md` exists and records per-VIS pass/fail plus key-link evidence.
- `.planning/REQUIREMENTS.md` marks VIS-01..VIS-07 as `Complete` only after verification evidence is recorded, with exactly seven VIS complete rows.
</success_criteria>

<output>
After completion, create `.planning/phases/08-visualization-reconciliation-verification/08-01-SUMMARY.md`
</output>
