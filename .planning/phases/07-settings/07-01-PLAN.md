---
phase: 07-settings
plan: 01
type: execute
wave: 1
depends_on: ["06-04"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Settings opens from menu-bar context menu, in-app gear, and Cmd+,"
    - "Only one Settings window exists; repeated opens focus it"
    - "Settings window remains accessible for LSUIElement/menu-bar app"
  artifacts:
    - path: "images/settings_final.png"
      provides: "Target Settings UI reference"
    - path: "Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift"
      provides: "Settings UI layout matching screenshot"
    - path: "Sources/PingScope/App/AppDelegate.swift"
      provides: "Settings window lifecycle + openSettings wiring"
    - path: "Sources/PingScope/PingMonitorApp.swift"
      provides: "Cmd+, wiring (appSettings command)"
---

<objective>
Make Settings feel native and reliable for a menu-bar (LSUIElement) app.

Purpose: Settings must be reachable from all UI entry points, and it must not spawn multiple windows or fail silently.
Output: Deterministic Settings open behavior + a single Settings window instance.
</objective>

<execution_context>
@/Users/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@images/settings_final.png
@Sources/PingScope/App/AppDelegate.swift
@Sources/PingScope/MenuBar/ContextMenuFactory.swift
@Sources/PingScope/Views/FullModeView.swift
@Sources/PingScope/Views/CompactModeView.swift
@Sources/PingScope/PingMonitorApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire Settings window to the screenshot-matching view</name>
  <files>Sources/PingScope/App/AppDelegate.swift, Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift</files>
  <action>
Implement a dedicated Settings window that uses `PingMonitorSettingsView` and remains reliable for a menu-bar (LSUIElement) app.

UI must match `images/settings_final.png`:
- header title + subtitle + divider
- Application / Display / Notifications sections
- Monitored Hosts list with Add Host button
- footer buttons: Reset to Defaults, Cancel, Done

Ensure the Settings window controller is created once and reused; repeated opens focus the existing window.
  </action>
  <verify>Build succeeds: `swift build`</verify>
  <done>Settings opens reliably and uses PingMonitorSettingsView</done>
</task>

<task type="auto">
  <name>Task 2: Route all Settings entry points through a single AppDelegate API</name>
  <files>Sources/PingScope/App/AppDelegate.swift, Sources/PingScope/PingMonitorApp.swift</files>
  <action>
Ensure there is one @objc AppDelegate method (openSettings) used by:
- menu-bar context menu (ContextMenuFactory actions)
- in-app gear menus (FullModeView / CompactModeView callbacks)
- Cmd+, command (SwiftUI commands)
  </action>
  <verify>Manual: open Settings via all entry points</verify>
  <done>All entry points open the same Settings window</done>
</task>

<task type="auto">
  <name>Task 3: Ensure multi-instance launches do not create multiple copies</name>
  <files>Info.plist, Sources/PingScope/App/AppDelegate.swift</files>
  <action>
Add a defense-in-depth layer so launching the app again does not spawn a second instance:
- Use Info.plist LSMultipleInstancesProhibited where applicable
- Add a runtime guard that activates an existing instance (by bundle id) and exits
  </action>
  <verify>Manual: launch app twice; only one instance remains</verify>
  <done>No duplicate running copies after repeated launches</done>
</task>

</tasks>

<verification>
- Manual verification of Settings open behavior across all entry points.
</verification>

<success_criteria>
- Cmd+, and the Settings menu actions reliably open a single Settings window.
- Re-launching the app does not result in multiple active instances.
</success_criteria>

<output>
After completion, create `.planning/phases/07-settings/07-01-SUMMARY.md`
</output>
