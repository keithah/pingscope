---
phase: 07-settings
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Hosts added/edited/deleted in Settings update the running monitor immediately"
    - "Settings uses the app's live HostListViewModel + HostStore wiring (no duplicate in-memory stores)"
  artifacts:
    - path: "Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift"
      provides: "Hosts section UI (Add/Edit/Remove buttons)"
    - path: "Sources/PingScope/App/AppDelegate.swift"
      provides: "Inject live HostListViewModel into Settings window"
---

<objective>
Ensure Settings changes apply immediately to the live app.

Purpose: Avoid having multiple HostStore instances that diverge in-memory. Settings must act on the same host list used by the scheduler/runtime.
Output: One shared host store, and Settings host CRUD triggers immediate monitoring updates.
</objective>

<execution_context>
@/Users/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@Sources/PingScope/Services/HostStore.swift
@Sources/PingScope/App/AppDelegate.swift
@Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift
@Sources/PingScope/Views/AddHostSheet.swift
@Sources/PingScope/ViewModels/AddHostViewModel.swift
@Sources/PingScope/ViewModels/HostListViewModel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Use the app's live HostListViewModel in Settings</name>
  <files>Sources/PingScope/App/AppDelegate.swift, Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift</files>
  <action>
Wire Settings hosts list to the same HostStore/HostListViewModel used by the running menu-bar UI.

Avoid creating a separate HostStore in Settings; changes must apply live.
  </action>
  <verify>Build succeeds: `swift build`</verify>
  <done>Settings host list matches running app host list</done>
</task>

<task type="auto">
  <name>Task 2: Wire Settings host CRUD to live refresh</name>
  <files>Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift, Sources/PingScope/App/AppDelegate.swift</files>
  <action>
When Settings adds/updates/removes hosts, the runtime scheduler and UI must update immediately.

Implementation options (choose the simplest that matches existing architecture):
- Provide AppDelegate methods for add/update/remove that call runtime.hostStore and then refresh scheduler
- Or expose a shared view model used by both popover and settings

Ensure default-host protection rules remain intact.
  </action>
  <verify>Manual: add host in Settings and see it appear in the monitoring UI immediately</verify>
  <done>No restart needed for host changes to take effect</done>
</task>

</tasks>

<verification>
- Manual verification of host add/edit/delete from Settings affects running monitor.
</verification>

<success_criteria>
- No divergent host lists between Settings and the menu-bar UI.
- Adding/removing hosts in Settings updates scheduler targets immediately.
</success_criteria>

<output>
After completion, create `.planning/phases/07-settings/07-02-SUMMARY.md`
</output>
