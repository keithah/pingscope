---
phase: 07-settings
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Settings values persist and reload consistently across quit/relaunch"
    - "Display toggles in Settings affect the running UI immediately"
    - "Notification Settings UI changes persist (delivery verification may be deferred)"
  artifacts:
    - path: "Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift"
      provides: "Settings toggles + persistence wiring"
    - path: "Sources/PingScope/MenuBar/DisplayPreferencesStore.swift"
      provides: "Persisted display preferences"
    - path: "Sources/PingScope/MenuBar/ModePreferenceStore.swift"
      provides: "Persisted compact/stay-on-top toggles"
    - path: "Sources/PingScope/MenuBar/NotificationPreferencesStore.swift"
      provides: "Persisted notification preferences"
    - path: "Sources/PingScope/Models/DisplayMode.swift"
      provides: "Shared display settings: monitored hosts visibility + history summary"
---

<objective>
Make Settings persistence predictable and consistent.

Purpose: After a restart, Settings should reflect the true persisted state and the app should load and apply that state immediately.
Output: Confirmed persistence for hosts, display mode toggles, and notification preference UI.
</objective>

<execution_context>
@/Users/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@Sources/PingScope/MenuBar/DisplayPreferencesStore.swift
@Sources/PingScope/MenuBar/ModePreferenceStore.swift
@Sources/PingScope/MenuBar/NotificationPreferencesStore.swift
@Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift
@Sources/PingScope/ViewModels/DisplayViewModel.swift
@Sources/PingScope/Models/DisplayMode.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Ensure Settings reads from persisted state on open</name>
  <files>Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift</files>
  <action>
Confirm Settings view initializes from canonical persisted state (UserDefaults stores) and persists changes.

If needed, add explicit reload behavior on appear/window focus.
  </action>
  <verify>Manual: change settings, quit, relaunch, confirm same values</verify>
  <done>Settings reflects persisted values after relaunch</done>
</task>

<task type="auto">
  <name>Task 2: Display settings updates apply immediately</name>
  <files>Sources/PingScope/Views/Settings/PingMonitorSettingsView.swift, Sources/PingScope/App/AppDelegate.swift, Sources/PingScope/ViewModels/DisplayViewModel.swift</files>
  <action>
Ensure Display toggles in Settings (Compact Mode / Stay on Top) route through AppDelegate so the running UI updates immediately.

Also ensure Display section toggles match the screenshot:
- Monitored Hosts: hides/shows the host pills in full mode
- Show Graph / Show History: collapse sections in full mode
- History Summary: shows stats block by default
  </action>
  <verify>Manual: toggle display settings and observe live UI behavior change</verify>
  <done>No restart required for display setting changes</done>
</task>

</tasks>

<verification>
- Manual persistence verification (hosts + display + notification settings UI).
</verification>

<success_criteria>
- Settings values persist across restarts.
- Display behavior matches persisted settings on relaunch.
</success_criteria>

<output>
After completion, create `.planning/phases/07-settings/07-03-SUMMARY.md`
</output>
