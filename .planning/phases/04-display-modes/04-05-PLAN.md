---
phase: 04-display-modes
plan: 05
type: execute
wave: 4
depends_on: ["04-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Full mode visually matches required composition and default target size"
    - "Compact mode visually matches required composition and six-row scroll behavior"
    - "Floating stay-on-top window is borderless, handle-draggable, and reopens near menu icon"
  artifacts:
    - path: "Sources/PingMonitor/Views/FullModeView.swift"
      provides: "Final full-mode user-visible surface"
      contains: "Hosts|Graph|Recent Results"
    - path: "Sources/PingMonitor/Views/CompactModeView.swift"
      provides: "Final compact-mode user-visible surface"
      contains: "Picker|Recent Results"
    - path: "Sources/PingMonitor/MenuBar/DisplayModeCoordinator.swift"
      provides: "Floating shell behavior users interact with"
      contains: "borderless|performDrag"
  key_links:
    - from: "Sources/PingMonitor/App/AppDelegate.swift"
      to: "Sources/PingMonitor/Views/DisplayRootView.swift"
      via: "live mode switching entry points"
      pattern: "toggle|mode"
    - from: "Sources/PingMonitor/MenuBar/DisplayModeCoordinator.swift"
      to: "NSStatusBarButton"
      via: "anchor near menu icon"
      pattern: "anchor|relativeTo|convertToScreen"
---

<objective>
Run final human verification against Phase 4 behavior and locked design constraints.

Purpose: Visual layout fidelity and interactive drag/space behavior cannot be fully proven by automated tests; this checkpoint confirms DISP-01..DISP-06 from actual user interaction.

Output: Approval signal (or issue list) for display mode and floating-window behavior.
</objective>

<execution_context>
@/Users/keith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/keith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-display-modes/04-CONTEXT.md
@.planning/phases/04-display-modes/04-RESEARCH.md
@.planning/phases/04-display-modes/04-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Full/compact display-mode UX with mode switching from quick toggle and settings, including per-mode memory for layout panels and size.
  </what-built>
  <how-to-verify>
1. Launch app: `swift run`
2. Open display from menu bar icon and confirm full mode opens around `450x500` with host pills + graph + recent results.
3. Collapse graph and history in full mode independently, switch to compact, then switch back; full collapsed states should be preserved.
4. In compact mode confirm dropdown selector is used (not pills), graph + recent results are visible, and recent results show six rows before scrolling.
5. Resize full mode, switch modes, and return to full; full size should be remembered.
6. Resize compact mode, switch modes, and return to compact; compact size should be remembered.
7. Switch host and time range, toggle mode, verify host/time-range selections are preserved.
  </how-to-verify>
  <resume-signal>Type "approved" if DISP-01/02/03 behavior matches expectations, or provide concrete mismatches.</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Stay-on-top floating-window behavior with borderless chrome, drag handle, current-space behavior, and anchor-near-icon reopen flow.
  </what-built>
  <how-to-verify>
1. Enable Stay on Top from quick toggle, open display, and verify it appears as borderless floating window (not standard titled window).
2. Attempt dragging from graph/history/body regions; window should not move.
3. Drag using the dedicated handle region; window should move smoothly.
4. Close floating window, click menu bar icon again; it should reopen in floating mode.
5. Toggle full/compact while floating; window should reopen/re-anchor near menu bar icon and remain visible on-screen.
6. Move to another macOS Space and verify window does not follow as all-spaces overlay.
  </how-to-verify>
  <resume-signal>Type "approved" if DISP-04/05/06 behavior is correct, or describe failure cases with reproduction steps.</resume-signal>
</task>

</tasks>

<verification>
- Manual validation confirms DISP-01, DISP-02, DISP-03, DISP-04, DISP-05, and DISP-06 behaviors
- Any issues are captured as actionable reproduction notes
</verification>

<success_criteria>
- Human verification explicitly approves mode composition, switching invariants, and floating behavior
- No unresolved blockers remain for Phase 4 completion
</success_criteria>

<output>
After completion, create `.planning/phases/04-display-modes/04-05-SUMMARY.md`
</output>
