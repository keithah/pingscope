---
phase: 10-true-icmp-support
plan: 04
type: execute
wave: 4
depends_on: ["10-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Sandbox detection correctly identifies runtime environment"
    - "ICMP option visible in UI when not sandboxed"
    - "ICMP option hidden in UI when sandboxed"
    - "True ICMP ping works for reachable hosts"
    - "Existing ping methods still work correctly"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete ICMP support implementation end-to-end.

Purpose: Human verification ensures the sandbox detection and ICMP functionality work correctly in the actual runtime environment.
Output: Confirmation that Phase 10 success criteria are met.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-true-icmp-support/10-RESEARCH.md
@.planning/phases/10-true-icmp-support/10-01-SUMMARY.md
@.planning/phases/10-true-icmp-support/10-02-SUMMARY.md
@.planning/phases/10-true-icmp-support/10-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete ICMP support implementation:
1. SandboxDetector utility for runtime sandbox detection
2. ICMPPacket structures (header, checksum)
3. ICMPPinger service with non-privileged socket ping
4. PingMethod.icmp case with conditional availability
5. PingService routing for ICMP
6. AddHostSheet filtering based on sandbox status
  </what-built>
  <how-to-verify>
**Build and run the app:**
```bash
cd /Users/keith/src/pingmonitor
swift build
swift run
```

**Test 1: Sandbox Detection (Developer ID build)**
When running via `swift run` (not sandboxed):
1. Open Add Host sheet (+ button)
2. Check Ping Method picker
3. Expected: Should see 4 options: TCP, UDP, ICMP (Simulated), ICMP

**Test 2: ICMP Ping Functionality**
1. Add a new host with:
   - Hostname: 8.8.8.8 (Google DNS)
   - Ping Method: ICMP
2. Save the host
3. Observe ping results in the host list
4. Expected: Should show latency values (typically 10-50ms to Google DNS)

**Test 3: Existing Methods Still Work**
1. Edit the host or add new hosts with TCP/UDP/ICMP-Simulated
2. Verify each method still produces ping results
3. Expected: All existing methods work unchanged

**Test 4: ICMP Error Handling**
1. Add a host with:
   - Hostname: 192.0.2.1 (TEST-NET, should not respond)
   - Ping Method: ICMP
2. Wait for timeout
3. Expected: Should show failure/timeout state (not crash)

**Note on Sandbox Testing:**
To test sandbox behavior, you would need to build and run an App Store sandbox version. For this verification, confirming the non-sandboxed path works is sufficient. The sandbox filtering is a simple string check that can be visually verified in code.
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
All Phase 10 success criteria verified:
1. App detects sandbox status at runtime via environment check
2. ICMPPinger service implements socket ping with proper timeout handling
3. PingMethod.icmp case available and functional when not sandboxed
4. ICMP option hidden from host configuration UI when sandboxed
5. Existing TCP/UDP/ICMP-simulated methods unchanged
</verification>

<success_criteria>
Human verifies:
- [ ] ICMP option appears in Add Host sheet when running non-sandboxed
- [ ] ICMP ping to reachable host (8.8.8.8) returns latency
- [ ] ICMP ping to unreachable host times out gracefully
- [ ] TCP/UDP/ICMP-Simulated methods still work correctly
- [ ] App does not crash or hang during any test
</success_criteria>

<output>
After completion, create `.planning/phases/10-true-icmp-support/10-04-SUMMARY.md`
</output>
