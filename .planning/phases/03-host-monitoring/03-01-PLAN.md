---
phase: 03-host-monitoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Sources/PingMonitor/Models/Host.swift
  - Sources/PingMonitor/Models/GlobalDefaults.swift
  - Sources/PingMonitor/Models/PingMethod.swift
autonomous: true

must_haves:
  truths:
    - "Host model supports all three ping methods (TCP, UDP, ICMP-simulated)"
    - "Per-host overrides fall back to global defaults when nil"
    - "Host is Codable for persistence"
  artifacts:
    - path: "Sources/PingMonitor/Models/Host.swift"
      provides: "Extended Host with per-host configuration and ping methods"
      contains: "PingMethod"
    - path: "Sources/PingMonitor/Models/GlobalDefaults.swift"
      provides: "Global default settings for ping monitoring"
      exports: ["GlobalDefaults"]
    - path: "Sources/PingMonitor/Models/PingMethod.swift"
      provides: "Ping method enum with ICMP-simulated support"
      exports: ["PingMethod"]
  key_links:
    - from: "Sources/PingMonitor/Models/Host.swift"
      to: "GlobalDefaults"
      via: "effective value methods"
      pattern: "effectiveInterval|effectiveTimeout|effectiveThresholds"
---

<objective>
Extend the Host model to support per-host configuration with global fallback, and add support for all three ping methods (TCP, UDP, ICMP-simulated).

Purpose: The existing Host model is minimal; Phase 3 requires per-host configurable interval, timeout, thresholds, and ping method. This plan creates the data model foundation for all other Phase 3 work.

Output: Extended Host model with optional per-host overrides, GlobalDefaults struct, and PingMethod enum including ICMP-simulated.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-host-monitoring/03-CONTEXT.md
@.planning/phases/03-host-monitoring/03-RESEARCH.md

@Sources/PingMonitor/Models/Host.swift
@Sources/PingMonitor/Models/PingResult.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PingMethod enum and GlobalDefaults</name>
  <files>
    Sources/PingMonitor/Models/PingMethod.swift
    Sources/PingMonitor/Models/GlobalDefaults.swift
  </files>
  <action>
Create `PingMethod.swift`:
- Enum with cases: `tcp`, `udp`, `icmpSimulated`
- Conform to `Sendable`, `Codable`, `CaseIterable`, `Equatable`
- `icmpSimulated` represents TCP connection probes to ports 53, 80, 443, 22, 25 in sequence (try until one succeeds)
- Add computed property `displayName: String` for UI (e.g., "TCP", "UDP", "ICMP (Simulated)")
- Add computed property `defaultPort: UInt16` (tcp: 80, udp: 53, icmpSimulated: 53)

Create `GlobalDefaults.swift`:
- Struct `GlobalDefaults` conforming to `Sendable`, `Codable`, `Equatable`
- Properties (matching CONTEXT.md responsive defaults):
  - `interval: Duration = .seconds(2)`
  - `timeout: Duration = .seconds(2)`
  - `greenThresholdMS: Double = 50.0`
  - `yellowThresholdMS: Double = 150.0`
  - `pingMethod: PingMethod = .tcp`
- Add `static let `default`` property returning default instance
- Note: These are "responsive defaults" per user decision; 2s interval provides quick feedback
  </action>
  <verify>
`swift build` compiles without errors. Both files exist and types are accessible from other modules.
  </verify>
  <done>
PingMethod enum has three cases with displayName and defaultPort. GlobalDefaults struct has all five properties with responsive default values (2s interval, 2s timeout, 50/150ms thresholds, TCP method).
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend Host model with per-host configuration</name>
  <files>
    Sources/PingMonitor/Models/Host.swift
  </files>
  <action>
Extend the existing Host model:

1. Add optional override properties (nil means use global):
   - `intervalOverride: Duration?`
   - `timeoutOverride: Duration?`
   - `greenThresholdMSOverride: Double?`
   - `yellowThresholdMSOverride: Double?`
   - `pingMethod: PingMethod` (not optional, required per host)

2. Replace `protocolType: ProtocolType` with `pingMethod: PingMethod`
   - Remove the nested `ProtocolType` enum (replaced by PingMethod)
   - Update init to use `pingMethod` parameter

3. Add effective value methods that take GlobalDefaults:
   - `func effectiveInterval(_ globals: GlobalDefaults) -> Duration`
   - `func effectiveTimeout(_ globals: GlobalDefaults) -> Duration`
   - `func effectiveGreenThresholdMS(_ globals: GlobalDefaults) -> Double`
   - `func effectiveYellowThresholdMS(_ globals: GlobalDefaults) -> Double`
   Each returns override if set, otherwise global value.

4. Make Host conform to `Codable`:
   - Duration is not natively Codable; add custom CodingKeys and init(from:)/encode(to:)
   - Encode Duration as TimeInterval (Double seconds)

5. Update static default hosts (googleDNS, cloudflareDNS):
   - Use `pingMethod: .tcp` instead of `protocolType: .tcp`
   - Keep `timeout: .seconds(3)` as explicit value (not using global fallback for defaults)

6. Add `static let defaults: [Host]` array containing googleDNS and cloudflareDNS
  </action>
  <verify>
`swift build` compiles without errors. Existing code using Host.ProtocolType will fail (expected); will be fixed in Plan 03 when PingService updates.
  </verify>
  <done>
Host model has optional override properties, pingMethod instead of protocolType, effective value methods, and is Codable. Duration encoding uses TimeInterval.
  </done>
</task>

</tasks>

<verification>
- `swift build` compiles (may have errors in PingService due to ProtocolType removal - expected, fixed in Plan 03)
- Models are in Sources/PingMonitor/Models/
- Host is Codable (can encode/decode to JSON)
- GlobalDefaults has responsive values per CONTEXT.md
</verification>

<success_criteria>
- PingMethod enum exists with tcp, udp, icmpSimulated cases
- GlobalDefaults struct exists with 2s interval, 2s timeout, 50/150ms thresholds
- Host model has optional override properties with effective value methods
- Host conforms to Codable with Duration encoded as TimeInterval
- Static default hosts updated to use PingMethod
</success_criteria>

<output>
After completion, create `.planning/phases/03-host-monitoring/03-01-SUMMARY.md`
</output>
