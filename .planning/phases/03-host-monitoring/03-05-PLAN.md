---
phase: 03-host-monitoring
plan: 05
type: execute
wave: 3
depends_on: ["03-03", "03-04"]
files_modified:
  - Sources/PingMonitor/Views/HostListView.swift
  - Sources/PingMonitor/Views/HostRowView.swift
  - Sources/PingMonitor/ViewModels/HostListViewModel.swift
autonomous: true

must_haves:
  truths:
    - "Host list shows all hosts in flat list with latency"
    - "Default hosts show lock icon indicator"
    - "Active host shows checkmark indicator"
    - "Tapping host row selects it as active"
  artifacts:
    - path: "Sources/PingMonitor/Views/HostListView.swift"
      provides: "Main host list view"
      min_lines: 40
    - path: "Sources/PingMonitor/Views/HostRowView.swift"
      provides: "Single host row component"
      min_lines: 30
    - path: "Sources/PingMonitor/ViewModels/HostListViewModel.swift"
      provides: "Host list state management"
      exports: ["HostListViewModel"]
  key_links:
    - from: "Sources/PingMonitor/Views/HostListView.swift"
      to: "HostListViewModel"
      via: "@ObservedObject or @StateObject"
      pattern: "@ObservedObject|@StateObject"
---

<objective>
Create the host list view with flat layout, host selection, and latency display.

Purpose: This is the primary UI for HOST-01 (monitor multiple hosts). Per CONTEXT.md: flat list, lock icon for defaults, checkmark for active host, each row shows name + current latency.

Output: HostListView displaying all hosts with indicators and selection.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-host-monitoring/03-CONTEXT.md
@.planning/phases/03-host-monitoring/03-RESEARCH.md

@Sources/PingMonitor/Models/Host.swift
@Sources/PingMonitor/Views/StatusPopoverView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HostListViewModel</name>
  <files>
    Sources/PingMonitor/ViewModels/HostListViewModel.swift
  </files>
  <action>
Create `HostListViewModel.swift`:

1. `@MainActor class HostListViewModel: ObservableObject`:
   - `@Published var hosts: [Host] = []`
   - `@Published var activeHostID: UUID?`
   - `@Published var latencies: [UUID: Double?] = [:]` (host ID -> latency in ms, nil if failed)
   - `@Published var showingAddSheet: Bool = false`
   - `@Published var hostToEdit: Host? = nil`
   - `@Published var hostToDelete: Host? = nil`

2. Callbacks (injected via init):
   - `onSelectHost: (Host) -> Void`
   - `onAddHost: (Host) -> Void`
   - `onUpdateHost: (Host) -> Void`
   - `onDeleteHost: (Host) -> Void`

3. Methods:
   - `func selectHost(_ host: Host)`:
     - Set activeHostID = host.id
     - Call onSelectHost(host)
   - `func updateLatency(for hostID: UUID, latencyMS: Double?)`:
     - Update latencies dictionary
   - `func triggerAdd()`: Set showingAddSheet = true
   - `func triggerEdit(_ host: Host)`: Set hostToEdit = host
   - `func triggerDelete(_ host: Host)`: Set hostToDelete = host
   - `func confirmDelete()`:
     - Guard let host = hostToDelete, !host.isDefault
     - Call onDeleteHost(host)
     - Set hostToDelete = nil

4. Computed properties:
   - `func isActive(_ host: Host) -> Bool`: host.id == activeHostID
   - `func latencyText(for host: Host) -> String`:
     - If latencies[host.id] is nil entry: return ""
     - If latencies[host.id] is .some(nil): return "Failed"
     - If latencies[host.id] is .some(.some(ms)): return "\(Int(ms))ms"
  </action>
  <verify>
`swift build` compiles. ViewModel manages host list state.
  </verify>
  <done>
HostListViewModel exists with hosts, activeHostID, latencies, and callbacks for selection/CRUD.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HostRowView and HostListView</name>
  <files>
    Sources/PingMonitor/Views/HostRowView.swift
    Sources/PingMonitor/Views/HostListView.swift
  </files>
  <action>
Create `HostRowView.swift`:

1. `struct HostRowView: View`:
   - Properties:
     - `let host: Host`
     - `let isActive: Bool`
     - `let latencyText: String`
     - `let onTap: () -> Void`
     - `let onEdit: () -> Void`
     - `let onDelete: () -> Void`

2. Body layout (per CONTEXT.md: "name + current latency"):
   - HStack with:
     - Checkmark indicator (SF Symbol "checkmark") if isActive, else empty space
     - Lock icon (SF Symbol "lock.fill") if host.isDefault, else empty space
     - Text(host.name) with primary font
     - Spacer
     - Text(latencyText) with secondary foreground color
   - Make entire row tappable via .onTapGesture { onTap() }

3. Context menu (not swipe actions - per macOS conventions):
   - "Edit" action -> onEdit() (available for all hosts)
   - "Delete" action -> onDelete() (only if !host.isDefault)

Create `HostListView.swift`:

1. `struct HostListView: View`:
   - `@ObservedObject var viewModel: HostListViewModel`

2. Body:
   - VStack with header and list
   - Header: "Hosts" title + "+" button (SF Symbol "plus") aligned right
   - List of HostRowView for each host in viewModel.hosts
   - Use ForEach with host.id as identifier

3. "+" button action: viewModel.triggerAdd()

4. Sheet modifiers:
   - `.sheet(isPresented: $viewModel.showingAddSheet)`:
     - Present AddHostSheet (created in Plan 06)
     - For now, use placeholder Text("Add Host Sheet")
   - `.sheet(item: $viewModel.hostToEdit)`:
     - Present AddHostSheet in edit mode
     - For now, use placeholder

5. Confirmation dialog for delete:
   - `.confirmationDialog` bound to viewModel.hostToDelete
   - Title: "Delete \(host.name)?"
   - Message: "This action cannot be undone."
   - Destructive "Delete" button -> viewModel.confirmDelete()
  </action>
  <verify>
`swift build` compiles. Views render host list with indicators.
  </verify>
  <done>
HostRowView shows name, latency, checkmark for active, lock for default. HostListView shows flat list with "+" button and delete confirmation.
  </done>
</task>

</tasks>

<verification>
- `swift build` compiles without errors
- Views exist in Sources/PingMonitor/Views/
- Host rows show indicators per CONTEXT.md
- List uses SwiftUI List with ForEach
</verification>

<success_criteria>
- HostListViewModel manages hosts, selection, latencies
- HostRowView shows host name + latency with checkmark/lock indicators
- HostListView renders flat list with "+" button
- Delete confirmation dialog works for non-default hosts
- Default hosts show lock icon and cannot be deleted
</success_criteria>

<output>
After completion, create `.planning/phases/03-host-monitoring/03-05-SUMMARY.md`
</output>
