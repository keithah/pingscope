---
phase: 06-notifications-settings
plan: 04
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified:
  - Sources/PingScope/PingMonitorApp.swift
  - Sources/PingScope/Views/Settings/HostSettingsView.swift
  - Sources/PingScope/Views/Settings/NotificationSettingsView.swift
autonomous: true

must_haves:
  truths:
    - "Settings panel has three tabs: Hosts, Notifications, Display"
    - "Host settings tab shows host list with add/edit/delete"
    - "Notification settings tab shows global toggle and alert type configuration"
    - "Display settings tab shows compact mode and stay-on-top toggles"
    - "Cmd+, opens settings window"
  artifacts:
    - path: "Sources/PingScope/Views/Settings/HostSettingsView.swift"
      provides: "Host management settings tab"
      min_lines: 40
    - path: "Sources/PingScope/Views/Settings/NotificationSettingsView.swift"
      provides: "Notification configuration tab"
      min_lines: 60
    - path: "Sources/PingScope/PingMonitorApp.swift"
      provides: "Settings scene with TabView"
      contains: "TabView"
  key_links:
    - from: "Settings TabView"
      to: "HostSettingsView"
      via: "tabItem"
      pattern: "tabItem.*Hosts"
    - from: "NotificationSettingsView"
      to: "NotificationPreferencesStore"
      via: "state binding"
      pattern: "NotificationPreferencesStore"
---

<objective>
Create the Settings panel with three tabs: Hosts, Notifications, and Display configuration.

Purpose: Provide users with a centralized settings interface for all app configuration (SETT-01, SETT-02, SETT-03).
Output: Native macOS Settings window with TabView containing host, notification, and display settings.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-notifications-settings/06-RESEARCH.md
@.planning/phases/06-notifications-settings/06-01-SUMMARY.md
@.planning/phases/06-notifications-settings/06-02-SUMMARY.md
@.planning/phases/06-notifications-settings/06-03-SUMMARY.md

# Existing files
@Sources/PingScope/PingMonitorApp.swift
@Sources/PingScope/Views/HostListView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HostSettingsView</name>
  <files>Sources/PingScope/Views/Settings/HostSettingsView.swift</files>
  <action>
Create new file in Views/Settings/ directory.

Create struct HostSettingsView: View with:
- @State private var hosts: [Host] = []
- @State private var selectedHost: Host? = nil
- @State private var showingAddSheet = false
- @State private var editingHost: Host? = nil

body:
- VStack with:
  - List showing hosts with selection
  - Each row shows host name, address, and notification status indicator
  - HStack at bottom with + button (Add), - button (Remove selected), Edit button

Add host: Set showingAddSheet = true
Edit host: Set editingHost = selectedHost
Remove host: Call HostStore to remove (use Task to call actor)

Use .sheet modifiers for add/edit (can reuse AddHostSheet from existing code)

Note: Since HostStore is an actor, read hosts on appear and after mutations:
```swift
.task {
    let store = HostStore()  // Or inject via environment
    hosts = await store.allHosts
}
```

Frame: .frame(width: 400, height: 300)
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>HostSettingsView displays host list with add/edit/delete controls</done>
</task>

<task type="auto">
  <name>Task 2: Create NotificationSettingsView</name>
  <files>Sources/PingScope/Views/Settings/NotificationSettingsView.swift</files>
  <action>
Create struct NotificationSettingsView: View with:
- @State private var preferences: NotificationPreferences
- private let store = NotificationPreferencesStore()

Initialize preferences from store in init or .onAppear

body using Form with .formStyle(.grouped):

Section("General") {
    Toggle("Enable Notifications", isOn: binding for globalEnabled)

    if preferences.globalEnabled {
        HStack {
            Text("Cooldown Period")
            Spacer()
            Picker("", selection: binding for cooldownSeconds) {
                Text("30 seconds").tag(30.0)
                Text("1 minute").tag(60.0)
                Text("2 minutes").tag(120.0)
                Text("5 minutes").tag(300.0)
            }
            .pickerStyle(.menu)
        }
    }
}

Section("Alert Types") {
    ForEach(AlertType.allCases, id: \.self) { alertType in
        Toggle(alertType.displayName, isOn: binding for enabledAlertTypes.contains(alertType))
    }
}
.disabled(!preferences.globalEnabled)

Section("Thresholds") {
    HStack {
        Text("High Latency Threshold")
        Spacer()
        TextField("ms", value: binding, format: .number)
            .frame(width: 60)
        Text("ms")
    }

    HStack {
        Text("Degradation Threshold")
        Spacer()
        TextField("%", value: binding, format: .number)
            .frame(width: 60)
        Text("%")
    }

    Stepper("Intermittent: \(preferences.intermittentFailureCount) failures in \(preferences.intermittentWindowSize) pings",
            value: binding for intermittentFailureCount, in: 2...10)
}
.disabled(!preferences.globalEnabled)

Save on change using .onChange(of: preferences) { store.savePreferences($0) }

Frame: .frame(width: 400, height: 400)
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>NotificationSettingsView shows all notification configuration options</done>
</task>

<task type="auto">
  <name>Task 3: Update PingMonitorApp with TabView Settings</name>
  <files>Sources/PingScope/PingMonitorApp.swift</files>
  <action>
Replace the Settings scene body in PingScopeApp:

Settings {
    SettingsTabView()
}

Create new struct SettingsTabView: View with:
- @State private var selectedTab = 0

body:
TabView(selection: $selectedTab) {
    HostSettingsView()
        .tabItem {
            Label("Hosts", systemImage: "server.rack")
        }
        .tag(0)

    NotificationSettingsView()
        .tabItem {
            Label("Notifications", systemImage: "bell")
        }
        .tag(1)

    DisplaySettingsView()
        .tabItem {
            Label("Display", systemImage: "display")
        }
        .tag(2)
}
.frame(width: 480, height: 420)

Keep the existing DisplaySettingsView (already implemented).
Remove SettingsPlaceholderView if no longer needed, or keep for backwards compat.

Update openSettings() in AppDelegate to use the new Settings scene properly - the existing code should work since it uses showSettingsWindow: selector.
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>Settings window shows TabView with Hosts, Notifications, and Display tabs</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `swift build` compiles without errors
2. Cmd+, opens Settings window
3. Settings has 3 tabs: Hosts, Notifications, Display
4. Host tab shows list with add/edit/delete
5. Notifications tab shows global toggle and alert type checkboxes
6. Display tab shows existing compact/stay-on-top toggles
</verification>

<success_criteria>
- Settings window opens with TabView
- Hosts tab provides host management UI
- Notifications tab configures global and per-alert-type settings
- Display tab shows existing display toggles
- All tabs use native macOS form styling
</success_criteria>

<output>
After completion, create `.planning/phases/06-notifications-settings/06-04-SUMMARY.md`
</output>
