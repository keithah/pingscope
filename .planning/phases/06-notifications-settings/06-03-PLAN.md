---
phase: 06-notifications-settings
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - Sources/PingScope/Models/Host.swift
  - Sources/PingScope/Views/AddHostSheet.swift
  - Sources/PingScope/ViewModels/AddHostViewModel.swift
autonomous: true

must_haves:
  truths:
    - "Host model includes notification enabled flag"
    - "User can enable/disable notifications per host in add/edit sheet"
    - "Per-host notification setting persists with host data"
  artifacts:
    - path: "Sources/PingScope/Models/Host.swift"
      provides: "Host with notificationsEnabled field"
      contains: "notificationsEnabled"
    - path: "Sources/PingScope/Views/AddHostSheet.swift"
      provides: "Toggle for per-host notifications"
      contains: "notificationsEnabled"
  key_links:
    - from: "AddHostSheet"
      to: "Host.notificationsEnabled"
      via: "form binding"
      pattern: "notificationsEnabled"
    - from: "Host"
      to: "HostStore"
      via: "Codable persistence"
      pattern: "encode|decode"
---

<objective>
Add per-host notification settings to the Host model and expose them in the add/edit host sheet.

Purpose: Allow users to configure which hosts should trigger notifications (NOTF-09).
Output: Host model has notificationsEnabled field; add/edit sheet includes notification toggle.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-notifications-settings/06-RESEARCH.md
@.planning/phases/06-notifications-settings/06-01-SUMMARY.md

# Existing files to modify
@Sources/PingScope/Models/Host.swift
@Sources/PingScope/Views/AddHostSheet.swift
@Sources/PingScope/ViewModels/AddHostViewModel.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add notificationsEnabled to Host model</name>
  <files>Sources/PingScope/Models/Host.swift</files>
  <action>
Add to Host struct:
- let notificationsEnabled: Bool (add after yellowThresholdMSOverride)

Update CodingKeys enum:
- Add case notificationsEnabled

Update init():
- Add parameter notificationsEnabled: Bool = true (default on for all hosts)
- Assign self.notificationsEnabled = notificationsEnabled

Update init(from decoder:):
- Decode notificationsEnabled with decodeIfPresent, default to true for backwards compatibility:
  notificationsEnabled = try container.decodeIfPresent(Bool.self, forKey: .notificationsEnabled) ?? true

Update encode(to encoder:):
- Encode notificationsEnabled

Update static let googleDNS and cloudflareDNS:
- Add notificationsEnabled: true to initializers (explicit for clarity)
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>Host model includes notificationsEnabled with backwards-compatible decoding</done>
</task>

<task type="auto">
  <name>Task 2: Update AddHostViewModel with notification toggle</name>
  <files>Sources/PingScope/ViewModels/AddHostViewModel.swift</files>
  <action>
Add to AddHostViewModel:
- @Published var notificationsEnabled: Bool = true

Update init(editing:) to load from existing host:
- self.notificationsEnabled = host.notificationsEnabled

Update makeHost() to include the field:
- Pass notificationsEnabled: notificationsEnabled to Host initializer

Update reset() to reset the field:
- notificationsEnabled = true
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>AddHostViewModel includes notificationsEnabled state</done>
</task>

<task type="auto">
  <name>Task 3: Add notification toggle to AddHostSheet</name>
  <files>Sources/PingScope/Views/AddHostSheet.swift</files>
  <action>
Add a new Section in the Form after the existing sections (before buttons):

Section("Notifications") {
    Toggle("Enable Notifications", isOn: $viewModel.notificationsEnabled)
}

This provides a simple toggle for the user to enable/disable notifications for this specific host.

The toggle should use the standard SwiftUI Toggle style to match existing form elements.
  </action>
  <verify>Build succeeds: `swift build 2>&1 | head -20`</verify>
  <done>AddHostSheet displays notification toggle in form</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `swift build` compiles without errors
2. Host model has notificationsEnabled property
3. Existing persisted hosts decode with notificationsEnabled = true (backwards compatible)
4. AddHostSheet shows notifications toggle
5. Creating/editing a host preserves the notification setting
</verification>

<success_criteria>
- Host.notificationsEnabled field exists with default true
- Backwards-compatible decoding for existing host data
- AddHostViewModel manages notification toggle state
- AddHostSheet displays toggle in Notifications section
- New/edited hosts persist notification preference
</success_criteria>

<output>
After completion, create `.planning/phases/06-notifications-settings/06-03-SUMMARY.md`
</output>
