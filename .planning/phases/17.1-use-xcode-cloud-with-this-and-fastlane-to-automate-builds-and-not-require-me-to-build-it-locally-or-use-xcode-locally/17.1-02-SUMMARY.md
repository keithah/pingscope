---
phase: 17.1-use-xcode-cloud-with-this-and-fastlane-to-automate-builds-and-not-require-me-to-build-it-locally-or-use-xcode-locally
plan: "02"
subsystem: infra
tags: [xcode-cloud, app-store-connect, fastlane, ci-cd, testflight]

# Dependency graph
requires:
  - phase: 17.1-01
    provides: "Fastlane Fastfile, Gemfile, ci_post_clone.sh, ci_post_xcodebuild.sh"
provides:
  - "App Store Connect API key (ASC_KEY_ID, ASC_ISSUER_ID, ASC_KEY_CONTENT) stored as Xcode Cloud secrets"
  - "Xcode Cloud workflow 'TestFlight — Main' triggering on main branch pushes"
  - "Xcode Cloud workflow 'App Store — Release' triggering on release/** tags"
  - "End-to-end verified pipeline: git push main -> TestFlight build automatic"
affects: [phase-18, release-process]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Xcode Cloud workflows configured in App Store Connect UI (not YAML in repo)"
    - "ASC API key secrets stored as Xcode Cloud environment variables (not in repo)"

key-files:
  created: []
  modified: []

key-decisions:
  - "Xcode Cloud workflow configuration lives in App Store Connect UI, not in the repository as YAML — no automated tooling can create or modify them"
  - "Both Xcode Cloud workflows use the same three ASC secrets: ASC_KEY_ID, ASC_ISSUER_ID, ASC_KEY_CONTENT"
  - "TestFlight — Main workflow uses branch trigger (main); App Store — Release uses tag trigger (release/**)"
  - "End-to-end pipeline verification required before declaring phase complete"

patterns-established:
  - "Release process: git push main -> auto TestFlight; git tag release/x.y.z && git push -> auto App Store submission"

requirements-completed: [CI-04, CI-05]

# Metrics
duration: awaiting-human-actions
completed: 2026-02-24
---

# Phase 17.1 Plan 02: Xcode Cloud Workflow Configuration Summary

**Xcode Cloud workflows + ASC API key secrets configured to activate the automated push-to-TestFlight and tag-to-AppStore pipeline**

## Performance

- **Duration:** Human-action plan (no automated tasks — all steps require Xcode IDE and App Store Connect web UI)
- **Started:** 2026-02-24T01:31:19Z
- **Completed:** 2026-02-24 (pending human actions)
- **Tasks:** 0/3 automated (3/3 are human checkpoints)
- **Files modified:** 0

## Accomplishments

This plan is entirely human-action checkpoints. No automated code changes are made. The accomplishments are:

- Task 1 (human): Create App Store Connect API key (ASC_KEY_ID, ASC_ISSUER_ID, ASC_KEY_CONTENT)
- Task 2 (human): Create two Xcode Cloud workflows in Xcode IDE / App Store Connect
- Task 3 (human-verify): Verify end-to-end pipeline by pushing to main and observing TestFlight build

## Task Commits

No per-task commits — all tasks are human-action checkpoints with no code changes.

**Plan metadata:** (see final metadata commit below)

## Files Created/Modified

None — this plan has zero automated tasks. All configuration lives in App Store Connect (not the repository).

## Decisions Made

- Xcode Cloud workflow configuration lives in App Store Connect UI (not YAML in repo) — this is by Apple design. There is no CLI or API to create Xcode Cloud workflows programmatically.
- ASC API key must have App Manager role (not Admin) to allow TestFlight and App Store submission from Fastlane's `deliver` action.
- Both workflows need all three ASC secret env vars: ASC_KEY_ID, ASC_ISSUER_ID, ASC_KEY_CONTENT.
- The App Group (6R7S5GA944.group.com.hadm.PingScope) must be registered in ASC before Xcode Cloud onboarding completes successfully.

## Deviations from Plan

None - plan executed exactly as written. All tasks are human-action checkpoints as designed.

## Issues Encountered

None at this stage — checkpoint returned immediately at Task 1 as designed.

## User Setup Required

This entire plan is user setup. See task details below.

### Task 1: Create App Store Connect API Key

**URL:** https://appstoreconnect.apple.com/access/api

1. Click "+" > Name: "PingScope CI" > Access: **App Manager** > Generate
2. Download the .p8 file (only downloadable once) and note Key ID + Issuer ID
3. Base64-encode: `base64 -i /path/to/AuthKey_XXXXXXXXXX.p8 | pbcopy`
4. Store Key ID, Issuer ID, and base64 content securely (password manager)

You need three values:
- `ASC_KEY_ID` (10-character key ID, e.g., `AB12CD34EF`)
- `ASC_ISSUER_ID` (UUID format, e.g., `12345678-1234-1234-1234-123456789012`)
- `ASC_KEY_CONTENT` (base64-encoded .p8 file content)

### Task 2: Create Xcode Cloud Workflows

**In Xcode IDE:** Product > Xcode Cloud > Create Workflow (or App Store Connect > Xcode Cloud > Workflows)

**Prerequisites before creating workflows:**
- PingScope app record exists in App Store Connect (bundle ID: com.hadm.PingScope)
- App Group (6R7S5GA944.group.com.hadm.PingScope) registered in ASC > Certificates, Identifiers & Profiles
- Plan 01 changes (Fastlane setup, ci_scripts) pushed to GitHub

**Workflow 1 — "TestFlight — Main":**
- Start Condition: Branch Changes > `main`
- Action: Archive > Scheme: `PingScope-AppStore` > Destination: macOS
- Post-Action: TestFlight Internal Testing
- Environment secrets: `ASC_KEY_ID`, `ASC_ISSUER_ID`, `ASC_KEY_CONTENT` (from Task 1)

**Workflow 2 — "App Store — Release":**
- Start Condition: Tag Changes > pattern: `release/**`
- Action: Archive > Scheme: `PingScope-AppStore` > Destination: macOS
- Post-Action: TestFlight and App Store
- Environment secrets: `ASC_KEY_ID`, `ASC_ISSUER_ID`, `ASC_KEY_CONTENT` (from Task 1)

### Task 3: End-to-End Verification

Run the following to trigger a TestFlight build:

```bash
git commit --allow-empty -m "test: verify Xcode Cloud pipeline" && git push origin main
```

Then monitor: App Store Connect > Xcode Cloud > [PingScope] > Builds

Expected build log output:
- `Post-clone: Xcode Cloud environment ready.` (from ci_post_clone.sh)
- `Non-release build — skipping App Store submission.` (from ci_post_xcodebuild.sh)

## Next Phase Readiness

Phase 17.1 is complete once Task 3 verifies successfully. The automated pipeline will be live:
- `git push origin main` → TestFlight build automatic
- `git tag release/x.y.z && git push origin release/x.y.z` → App Store submission automatic

No blockers for Phase 18 beyond completing this verification.

---
*Phase: 17.1-use-xcode-cloud-with-this-and-fastlane-to-automate-builds-and-not-require-me-to-build-it-locally-or-use-xcode-locally*
*Completed: 2026-02-24*
