# Phase 17.1: CI/CD Automation - Context

**Gathered:** 2026-02-23
**Status:** Ready for planning

<domain>
## Phase Boundary

Automate App Store builds and distribution using Xcode Cloud and Fastlane. After this phase: pushing to main triggers a TestFlight build automatically; pushing a `release/` tag triggers App Store submission without any manual steps. Developer ID automation and GitHub Actions CI are out of scope for this phase.

</domain>

<decisions>
## Implementation Decisions

### Tool Role Split
- **Xcode Cloud** owns all CI/CD: builds the App Store variant, signs it, uploads to App Store Connect
- **Fastlane** owns App Store Connect automation only — specifically the `ci_post_xcodebuild.sh` hook that calls `deliver(submit_for_review: true)` on release tag builds
- GitHub Actions and Developer ID automation are explicitly out of scope

### Build Triggers
- **Push to main branch** → Xcode Cloud triggers TestFlight build automatically
- **Git tag matching `release/x.y.z`** → Xcode Cloud builds App Store variant AND auto-submits for App Store review via Fastlane `deliver(submit_for_review: true)` in `ci_post_xcodebuild.sh`

### Distribution Targets
- **App Store variant**: TestFlight on every main push. App Store review submission on `release/` tag — fully automated, no manual App Store Connect steps.
- Developer ID variant is out of scope for this phase.

### Version and Build Number Management
- **Marketing version** (e.g., 1.2.0): Managed manually in the Xcode project. Developer bumps this before pushing a release tag.
- **Build number** (CFBundleVersion): Xcode Cloud auto-increments on each build. Zero manual maintenance required.

### Signing
- **App Store signing**: Managed by Xcode Cloud natively (automatic signing, no manual cert setup).
- Developer ID signing is out of scope for this phase.

### App Store Auto-Submit
- App Store review submission must be **fully automated** — no manual step in App Store Connect
- `release/x.y.z` tag → Xcode Cloud builds → `ci_post_xcodebuild.sh` calls Fastlane `deliver(submit_for_review: true)`
- App Store Connect API key (not password) must be stored in Xcode Cloud environment variables
- Fastlane uses ASC API key from environment for headless, non-interactive submission

### Claude's Discretion
- Specific Fastlane lane names and Fastfile structure
- Exact Xcode Cloud workflow configuration (two workflows: main branch + release tag)
- Notification setup for build success/failure

</decisions>

<specifics>
## Specific Ideas

- Pushing to GitHub should "just work" — no manual steps after push
- TestFlight should receive every main-branch build automatically
- App Store review submission should be triggered automatically by a `release/` tag — no manual App Store Connect steps

</specifics>

<deferred>
## Deferred Ideas

- **Developer ID automation** (GitHub Actions .dmg build + GitHub Releases upload) — deferred to a future phase
- **GitHub Actions CI** (compile + test on every PR/push) — deferred to a future phase

</deferred>

---

*Phase: 17.1-use-xcode-cloud-with-this-and-fastlane-to-automate-builds-and-not-require-me-to-build-it-locally-or-use-xcode-locally*
*Context gathered: 2026-02-23*
