---
phase: 13-xcode-infrastructure-setup
plan: 03
type: execute
wave: 3
depends_on: [13-02]
files_modified:
  - PingScope.xcodeproj/project.pbxproj
  - PingScope.xcodeproj/xcshareddata/xcschemes/PingScope-AppStore.xcscheme
  - PingScope.xcodeproj/xcshareddata/xcschemes/PingScope-DeveloperID.xcscheme
  - .gitignore
autonomous: false
requirements:
  - INFRA-01
  - INFRA-03
  - INFRA-04

must_haves:
  truths:
    - "Xcode project exists wrapping Package.swift as local dependency"
    - "AppStore build scheme configured with sandbox entitlements"
    - "DeveloperID build scheme configured with non-sandbox entitlements"
    - "Both schemes reference Configuration/Info.plist"
    - "Asset catalog integrated into both schemes"
  artifacts:
    - path: "PingScope.xcodeproj/project.pbxproj"
      provides: "Xcode project wrapper for SPM executable"
      contains: "PingScope.xcodeproj"
    - path: "PingScope.xcodeproj/xcshareddata/xcschemes/PingScope-AppStore.xcscheme"
      provides: "App Store build scheme"
      contains: "PingScope-AppStore"
    - path: "PingScope.xcodeproj/xcshareddata/xcschemes/PingScope-DeveloperID.xcscheme"
      provides: "Developer ID build scheme"
      contains: "PingScope-DeveloperID"
  key_links:
    - from: "PingScope.xcodeproj"
      to: "Package.swift"
      via: "Local package dependency"
      pattern: "Add Local.*Package.swift"
    - from: "PingScope-AppStore scheme"
      to: "Configuration/PingScope-AppStore.entitlements"
      via: "Code Signing Entitlements build setting"
      pattern: "CODE_SIGN_ENTITLEMENTS"
    - from: "Both schemes"
      to: "Assets.xcassets"
      via: "Asset catalog compilation"
      pattern: "ASSETCATALOG_COMPILER"
---

<objective>
Create Xcode project wrapper with dual build schemes for App Store and Developer ID distributions.

Purpose: Enable App Store distribution capability while preserving Developer ID workflow. Xcode project references Package.swift as local dependency, avoiding source duplication.
Output: Xcode project with two build schemes configured for different distribution channels
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-xcode-infrastructure-setup/13-RESEARCH.md
@.planning/phases/13-xcode-infrastructure-setup/13-01-SUMMARY.md
@.planning/phases/13-xcode-infrastructure-setup/13-02-SUMMARY.md

@Package.swift
@Configuration/PingScope-AppStore.entitlements
@Configuration/PingScope-DeveloperID.entitlements
@Configuration/Info.plist
@Assets.xcassets/AppIcon.appiconset/Contents.json
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Create Xcode project wrapper and configure build schemes</name>
  <action>Xcode project creation and scheme configuration</action>
  <instructions>
    Xcode project creation requires GUI interaction. Follow these steps:

    **Step 1: Create Xcode Project**
    1. Open Xcode: `open -a Xcode`
    2. File → New → Project
    3. Select: macOS → App
    4. Configure:
       - Product Name: PingScope
       - Organization Identifier: com.hadm
       - Bundle Identifier: com.hadm.pingscope (auto-filled)
       - Interface: SwiftUI
       - Language: Swift
       - Include Tests: No (we have SPM tests)
    5. Save Location: Repository root (same level as Package.swift)

    **Step 2: Add Local Package Dependency**
    1. Delete auto-generated ContentView.swift and PingScopeApp.swift (keep project only)
    2. File → Add Package Dependencies
    3. Click "Add Local..." button (bottom left)
    4. Select repository root directory (where Package.swift lives)
    5. Xcode discovers PingScope executable target automatically
    6. Click "Add Package"

    **Step 3: Configure App Target**
    1. Select PingScope target in Project Navigator
    2. General tab:
       - Bundle Identifier: com.hadm.pingscope
       - Version: 1.1.0 (for MARKETING_VERSION)
       - Build: 1 (for CURRENT_PROJECT_VERSION)
    3. Build Settings tab (search for each):
       - MARKETING_VERSION = 1.1.0
       - CURRENT_PROJECT_VERSION = 1
       - INFOPLIST_FILE = Configuration/Info.plist
       - CODE_SIGN_ENTITLEMENTS = (leave empty, will be set per scheme)
       - ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon
       - ASSETCATALOG_COMPILER_GLOBAL_ACCENT_COLOR_NAME = (leave empty)
    4. Info tab:
       - Verify values come from Configuration/Info.plist

    **Step 4: Create App Store Build Scheme**
    1. Product → Scheme → Manage Schemes
    2. Click "+" to add new scheme
    3. Name: PingScope-AppStore
    4. Target: PingScope
    5. Click "Edit..."
    6. Build Settings (Build tab):
       - Code Signing Entitlements: Configuration/PingScope-AppStore.entitlements
       - Code Signing Identity: Apple Distribution
    7. Archive tab:
       - Archive Name: PingScope-AppStore
    8. Check "Shared" to commit scheme to git

    **Step 5: Create Developer ID Build Scheme**
    1. Duplicate PingScope-AppStore scheme (right-click → Duplicate)
    2. Rename to: PingScope-DeveloperID
    3. Edit scheme:
       - Code Signing Entitlements: Configuration/PingScope-DeveloperID.entitlements
       - Code Signing Identity: Developer ID Application
    4. Check "Shared" to commit scheme to git

    **Step 6: Set Default Scheme**
    1. Product → Scheme → Manage Schemes
    2. Check "Show" for PingScope-DeveloperID (make it default)
    3. Uncheck "Show" for auto-generated PingScope scheme (if exists)
    4. Close

    **Step 7: Update .gitignore**
    Add Xcode-specific ignores to .gitignore:
    ```
    # Xcode
    *.xcodeproj/*
    !*.xcodeproj/project.pbxproj
    !*.xcodeproj/xcshareddata/
    xcuserdata/
    DerivedData/
    *.xcworkspace/!**/xcshareddata/
    ```

    **Verification:**
    - [ ] PingScope.xcodeproj exists in repository root
    - [ ] Project Navigator shows PingScope package under Dependencies
    - [ ] Two schemes visible: PingScope-AppStore and PingScope-DeveloperID
    - [ ] Both schemes show in Product → Scheme menu
    - [ ] Build Settings show MARKETING_VERSION = 1.1.0
    - [ ] Asset catalog shows app icon preview in Xcode

    **Common issues:**
    - "No such module PingScope": Clean build folder (Product → Clean Build Folder), reset package cache (File → Packages → Reset Package Caches)
    - Scheme uses wrong entitlements: Edit scheme → Build Settings tab → verify Code Signing Entitlements path
    - Icon doesn't show: Verify ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon in build settings
  </instructions>
  <resume-signal>Type "done" when Xcode project created with both schemes configured, or describe blocking issues</resume-signal>
</task>

</tasks>

<verification>
After human completes checkpoint:
- Xcode project exists: `ls PingScope.xcodeproj/project.pbxproj`
- Schemes committed: `ls PingScope.xcodeproj/xcshareddata/xcschemes/`
- Local package referenced: `grep -q "Package.swift" PingScope.xcodeproj/project.pbxproj`
- .gitignore updated: `grep -q "xcuserdata" .gitignore`
</verification>

<success_criteria>
- PingScope.xcodeproj exists wrapping Package.swift as local dependency
- PingScope-AppStore scheme configured with sandbox entitlements and Apple Distribution signing
- PingScope-DeveloperID scheme configured with non-sandbox entitlements and Developer ID signing
- Both schemes reference Configuration/Info.plist with version variables
- Asset catalog integrated showing 1024x1024 app icon
- .gitignore updated to exclude Xcode user data while preserving shared schemes
</success_criteria>

<output>
After completion, create `.planning/phases/13-xcode-infrastructure-setup/13-03-SUMMARY.md`
</output>
