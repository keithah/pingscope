---
phase: 16-submission-and-distribution
plan: 03
type: execute
wave: 3
depends_on: [16-02]
files_modified:
  - AppStoreAssets/SUBMISSION.md
autonomous: false
requirements: [SUBM-07, SUBM-08]

must_haves:
  truths:
    - "First submission to App Review completed successfully"
    - "Submission workflow documented for reproducibility"
    - "All metadata and screenshots uploaded to App Store Connect"
  artifacts:
    - path: "AppStoreAssets/SUBMISSION.md"
      provides: "Manual submission workflow documentation"
      min_lines: 50
  key_links: []
---

<objective>
Submit first build to App Review and document the complete manual submission workflow.

Purpose: Complete App Store Review submission with all metadata, screenshots, and review notes. Document every step for future releases and team handoff.
Output: First submission to App Review completed, comprehensive workflow documentation created.
</objective>

<execution_context>
@/Users/keith/.claude/get-shit-done/workflows/execute-plan.md
@/Users/keith/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-submission-and-distribution/16-RESEARCH.md
@.planning/phases/16-submission-and-distribution/16-01-SUMMARY.md
@.planning/phases/16-submission-and-distribution/16-02-SUMMARY.md
@AppStoreAssets/Metadata/
@AppStoreAssets/Screenshots/
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Complete App Store Connect listing and submit for review</action>
  <instructions>
**What to do:** Fill out App Store Connect listing with metadata and screenshots, then submit first build for App Review.

**Prerequisites:**
- TestFlight build tested and approved (from Plan 02)
- All metadata files ready in AppStoreAssets/Metadata/
- All screenshots ready in AppStoreAssets/Screenshots/

**Steps:**

1. **Navigate to App Store Connect**
   - Go to https://appstoreconnect.apple.com
   - Click "My Apps" → "PingScope"
   - Click "App Store" tab (not TestFlight)

2. **Create First Version (1.1.0)**
   - Click "+" button to add version
   - Version Number: 1.1.0
   - Click "Create"

3. **Upload Screenshots**
   - Go to "App Store" → "1.1.0 Prepare for Submission" → Media Manager
   - macOS section → "13-inch Display" (2880x1800)
   - Drag and drop all 5 screenshots from AppStoreAssets/Screenshots/:
     1. menu-bar-full-interface.png (menu bar + full interface overview)
     2. multi-host-graph.png (multi-host tabs + latency graph)
     3. settings.png (settings window with all tabs)
     4. ping-history.png (history table with timestamps)
     5. compact-mode.png (compact display mode)
   - Verify all screenshots appear in correct order
   - Rearrange if needed (drag to reorder)

4. **Fill App Information**
   - Go to "App Information" (left sidebar)
   - Name: PingScope (from AppStoreAssets/Metadata/app-name.txt)
   - Subtitle: Network Latency Monitor (from subtitle.txt)
   - Category → Primary: Utilities
   - Copyright: © 2026 Keith Irwin (from copyright.txt)

5. **Fill Version Information**
   - Go back to "1.1.0 Prepare for Submission"
   - Description: Copy/paste from AppStoreAssets/Metadata/description.txt (1577 chars)
   - Keywords: Copy/paste from keywords.txt (95 chars)
   - Support URL: Copy/paste from support-url.txt
   - Promotional Text: Copy/paste from promotional-text.txt (158 chars)

6. **Select Build**
   - In "Build" section, click "Select a build before you submit your app"
   - Choose the TestFlight build (version 1.1.0 build 1)
   - Click "Done"

7. **Complete App Review Information**
   - Sign-in Required: NO (app works without account)
   - App Review Notes: Copy/paste from AppStoreAssets/Metadata/review-notes.txt
     - Explains dual sandbox model (App Store vs Developer ID)
     - Testing instructions for ICMP hidden, TCP/UDP functional
     - Privacy compliance summary
   - Contact Information: Fill with your contact details

8. **Complete Version Release**
   - Version Release: "Automatically release this version"
   - (or "Manually release this version" if you want approval before public release)

9. **Complete Content Rights**
   - Advertising Identifier: NO (app doesn't use advertising frameworks)

10. **Submit for Review**
    - Review all sections - must be complete (no warnings)
    - Click "Add for Review" button (top right)
    - Confirmation dialog: Click "Submit"
    - Status changes to "Waiting for Review"

**Expected timeline:**
- Submission accepted: Immediate (status: "Waiting for Review")
- Review starts: 24-48 hours typically (90% reviewed in <24 hours)
- Review complete: 1-3 days for first submission
- Email notification: "Your app status has changed" when reviewed

**Common submission issues:**
- Missing screenshots: Need at least 1 screenshot for 2880x1800 resolution
- Description too short: Must be at least 10 characters
- Missing review notes: Helpful but not required
- Build not selected: Must select TestFlight build before submit

**After submission:**
- Monitor App Store Connect for status changes
- Check email for App Review communications
- If rejected: Read rejection reason, address issues, resubmit
- If approved: App automatically released (or manually if selected)

**Why human-required:** App Store Connect UI interaction required (no API for initial submission metadata), review notes need human judgment, submission timing decision.
  </instructions>
  <resume-signal>Type "submitted" when submission completes successfully (status: "Waiting for Review" or "In Review"), or describe issues if submission fails</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Document manual submission workflow</name>
  <files>
    AppStoreAssets/SUBMISSION.md
  </files>
  <action>
Create AppStoreAssets/SUBMISSION.md documenting the complete manual submission workflow for future releases:

```markdown
# PingScope App Store Submission Workflow

**Last updated:** 2026-02-17 (v1.1.0 submission)

## Overview

Manual workflow for submitting PingScope to the Mac App Store. Follow these steps for each new version release.

## Prerequisites

Before starting submission:
- [ ] All features tested and stable
- [ ] Regression tests pass (`swift test`)
- [ ] Metadata files updated in AppStoreAssets/Metadata/
- [ ] Screenshots captured (if UI changed)
- [ ] Version numbers incremented in Configuration/Info.plist

## Step 1: Build and Archive

### 1.1 Update Version Numbers

Edit `Configuration/Info.plist`:
```xml
<key>CFBundleShortVersionString</key>
<string>1.1.0</string>  <!-- Marketing version -->
<key>CFBundleVersion</key>
<string>1</string>      <!-- Build number - increment for each upload -->
```

**Important:** Increment `CFBundleVersion` for every upload attempt, even if fixing bugs.

### 1.2 Archive App Store Build

```bash
# Clean build environment
rm -rf dist/
mkdir -p dist/

# Archive
xcodebuild archive \
  -project PingScope.xcodeproj \
  -scheme PingScope-AppStore \
  -destination 'generic/platform=macOS' \
  -archivePath dist/PingScope.xcarchive

# Export as .pkg
xcodebuild -exportArchive \
  -archivePath dist/PingScope.xcarchive \
  -exportOptionsPlist Configuration/ExportOptions-AppStore.plist \
  -exportPath dist/
```

Expected output: `dist/PingScope.pkg` (macOS uses .pkg for App Store, not .app)

### 1.3 Validate Locally

```bash
./Scripts/validate-appstore-build.sh
```

Expected: All 7 checks pass (sandbox, network client, bundle ID, signature, version format).

## Step 2: Upload to App Store Connect

### 2.1 Validate with Apple

Using xcrun altool:
```bash
xcrun altool --validate-app \
  -f dist/PingScope.pkg \
  -t macos \
  --apiKey YOUR_KEY_ID \
  --apiIssuer YOUR_ISSUER_ID
```

Or using Transporter app: Open Transporter → Add App → Select .pkg → Click "Verify"

### 2.2 Upload Package

Using xcrun altool:
```bash
xcrun altool --upload-app \
  -f dist/PingScope.pkg \
  -t macos \
  --apiKey YOUR_KEY_ID \
  --apiIssuer YOUR_ISSUER_ID
```

Or using Transporter app: Open Transporter → Add App → Select .pkg → Click "Deliver"

**Expected timeline:**
- Upload: 1-5 minutes
- Processing: 5-30 minutes
- Email: "Your app has been processed" (wait for this before proceeding)

### 2.3 Common Upload Errors

| Error | Cause | Fix |
|-------|-------|-----|
| ITMS-90062 (duplicate binary) | Same CFBundleVersion uploaded twice | Increment CFBundleVersion, rebuild, re-upload |
| Invalid provisioning profile | Profile doesn't match bundle ID | Download latest App Store profile from developer portal |
| Missing app record | App not created in App Store Connect | Create app record with bundle ID com.hadm.pingscope |
| Processing stuck >1 hour | Invalid binary (icons, entitlements, Info.plist) | Check email for error details, fix and re-upload |

## Step 3: TestFlight Internal Testing

### 3.1 Configure Build

1. Go to App Store Connect → PingScope → TestFlight
2. Click on the processed build (status: "Ready to Submit")
3. Complete export compliance:
   - Question: "Does your app use encryption?"
   - Answer: **NO** (uses standard TLS only, no custom encryption)
4. Add beta app description and feedback email (if first time)

### 3.2 Add to Internal Testing Group

1. Go to TestFlight → Internal Testing
2. Click existing group (e.g., "Internal Team") or create new group
3. Click "Builds" → "+" → Select build → Add
4. Ensure testers are added to group (App Store Connect users only)

### 3.3 Test Build

Testers receive email invitation. Install TestFlight app, install build, and verify:

**Sandbox Behavior Checklist:**
- [ ] ICMP method hidden in Settings → Hosts → Method dropdown
- [ ] TCP ping works (test with google.com port 80)
- [ ] UDP ping works (test with 8.8.8.8 port 53)
- [ ] Menu bar shows latency updates
- [ ] No crashes during 5-minute session
- [ ] Console.app shows SandboxDetector log with sandbox=true

**Expected:** App Store build identical to Developer ID except ICMP hidden.

## Step 4: Submit for App Review

### 4.1 Prepare Metadata

Ensure all files current in AppStoreAssets/Metadata/:
- app-name.txt (max 30 chars)
- subtitle.txt (max 30 chars)
- description.txt (max 4000 chars)
- keywords.txt (max 100 chars)
- promotional-text.txt (max 170 chars)
- copyright.txt
- support-url.txt
- review-notes.txt (explain dual sandbox model)

Validate character counts:
```bash
./Scripts/validate-metadata.sh
```

### 4.2 Upload Screenshots

Screenshots location: `AppStoreAssets/Screenshots/`

Required for 13-inch Display (2880x1800):
1. menu-bar-full-interface.png
2. multi-host-graph.png
3. settings.png
4. ping-history.png
5. compact-mode.png

Upload in App Store Connect → Media Manager → drag/drop screenshots.

### 4.3 Complete Submission

1. Go to App Store Connect → My Apps → PingScope → App Store
2. Create new version (e.g., 1.1.0)
3. Fill all required fields:
   - Name, Subtitle, Category, Copyright
   - Description, Keywords, Support URL, Promotional Text
   - Select build (from TestFlight)
   - App Review Notes (copy from review-notes.txt)
4. Complete Content Rights (Advertising Identifier: NO)
5. Choose version release (Automatic or Manual)
6. Click "Add for Review"
7. Confirm submission

**Status changes:**
- "Waiting for Review" → Submitted successfully
- "In Review" → Reviewer started testing (24-48 hours)
- "Pending Developer Release" → Approved, awaiting manual release
- "Ready for Sale" → Live on App Store

## Step 5: Post-Submission

### 5.1 Monitor Status

Check App Store Connect daily:
- Status updates appear in "App Store" tab
- Email notifications sent on status changes

### 5.2 Handle Rejection

If rejected:
1. Read rejection reason carefully (email + Resolution Center)
2. Address issues in code or metadata
3. Increment CFBundleVersion
4. Rebuild, upload, resubmit
5. Add clarification in review notes if rejection unclear

Common rejection reasons:
- App doesn't match description
- Screenshots outdated or misleading
- Missing functionality mentioned in description
- Privacy manifest incomplete
- Sandbox violations

### 5.3 Release Management

**Automatic release:**
- App goes live immediately upon approval
- No action needed

**Manual release:**
- Click "Release This Version" when ready
- Useful for coordinating with marketing, blog posts

## Gotchas and Tips

### Version Number Management

- `CFBundleShortVersionString`: Marketing version (1.1.0) - increment for features
- `CFBundleVersion`: Build number (1, 2, 3...) - increment for every upload
- Build number must be unique across all uploads ever (never reuse)
- App Store Connect rejects duplicate build numbers even if previous rejected

### Build Number Strategy

Option A (manual): 1, 2, 3, 4... (simple, requires tracking)
Option B (git-based): Use commit count as build number (automated in CI/CD)

### API Key Setup (for altool automation)

1. Generate in App Store Connect → Users and Access → Keys
2. Role: App Manager or Developer
3. Download AuthKey_XXXXX.p8 (ONE TIME DOWNLOAD - save securely)
4. Note Key ID and Issuer ID
5. Store in keychain:
```bash
xcrun notarytool store-credentials "AppStoreConnectAPI" \
  --key /path/to/AuthKey_XXXXX.p8 \
  --key-id XXXXX \
  --issuer XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
```

### Metadata Character Limits

Validate before uploading to avoid UI truncation:
```bash
./Scripts/validate-metadata.sh
```

Limits strictly enforced:
- App Name: 30 chars
- Subtitle: 30 chars
- Keywords: 100 chars (comma-separated)
- Promotional Text: 170 chars
- Description: 4000 chars

### Screenshot Requirements

- Resolution: 2880x1800 exactly (13-inch Retina display)
- Format: PNG or JPEG
- No alpha transparency (use opaque backgrounds)
- Minimum: 1 screenshot
- Maximum: 10 screenshots
- Order matters (first screenshot shows in search results)

### Review Timeline Expectations

| Submission Type | Typical Timeline |
|----------------|------------------|
| First submission | 2-4 days |
| Updates (minor) | 24-48 hours |
| Updates (major features) | 2-3 days |
| Rejections fixed | 24-48 hours |

90% of apps reviewed in <24 hours per Apple's published stats.

### TestFlight Limits

- Internal testers: Max 100 (App Store Connect users)
- External testers: Max 10,000 (requires App Review for first build)
- Build expiration: 90 days from upload
- Testing groups: Unlimited

### Dual Distribution Model

PingScope ships two builds:
1. **App Store** (sandboxed): ICMP hidden, TCP/UDP functional
2. **Developer ID** (non-sandboxed): ICMP functional, TCP/UDP functional

Review notes must explain this difference to App Review team. App Store build tested via TestFlight, Developer ID build tested locally.

## Checklist Template

Use this checklist for each submission:

**Pre-submission:**
- [ ] Version numbers updated in Configuration/Info.plist
- [ ] Regression tests pass
- [ ] Metadata files reviewed and validated
- [ ] Screenshots current (if UI changed)

**Build:**
- [ ] Archive created with PingScope-AppStore scheme
- [ ] Package exported (dist/PingScope.pkg)
- [ ] Local validation passes (validate-appstore-build.sh)

**Upload:**
- [ ] altool validation passes
- [ ] Package uploaded to App Store Connect
- [ ] Email confirmation received (build processed)

**TestFlight:**
- [ ] Export compliance completed
- [ ] Build added to internal testing group
- [ ] TestFlight build tested (ICMP hidden, TCP/UDP work)

**App Review:**
- [ ] Metadata uploaded to App Store Connect
- [ ] Screenshots uploaded (5 screenshots at 2880x1800)
- [ ] Build selected for version
- [ ] Review notes filled (explain dual sandbox model)
- [ ] Submitted for review

**Post-submission:**
- [ ] Status monitored daily
- [ ] Ready for release (manual) or auto-released
- [ ] GitHub release created (tag v1.1.0)
- [ ] README updated with App Store link

---

**Document version:** 1.0 (first submission)
**Next review:** After first App Review feedback
```

Save and commit SUBMISSION.md.
  </action>
  <verify>
File AppStoreAssets/SUBMISSION.md exists and contains:
- Complete Step 1-5 workflow
- Version number management guidance
- Upload command examples with altool
- TestFlight testing checklist
- App Review submission instructions
- Gotchas section with API key setup, metadata limits, screenshot requirements
- Checklist template for future submissions

File is at least 50 lines (comprehensive documentation).
  </verify>
  <done>
AppStoreAssets/SUBMISSION.md created with complete manual submission workflow documented. Workflow covers build, upload, TestFlight, App Review submission, and post-submission monitoring. Includes gotchas, tips, and checklist template.
  </done>
</task>

</tasks>

<verification>
After completion:
- First submission to App Review completed (status: Waiting for Review)
- All metadata uploaded (name, subtitle, description, keywords, promotional text)
- All 5 screenshots uploaded to App Store Connect
- Review notes uploaded explaining dual sandbox model
- Build selected and linked to version 1.1.0
- AppStoreAssets/SUBMISSION.md created with workflow documentation
</verification>

<success_criteria>
- Submission accepted by App Store Connect (no validation errors)
- Status shows "Waiting for Review" or "In Review"
- All required metadata fields completed
- 5 screenshots uploaded for 13-inch display
- Review notes explain App Store vs Developer ID builds
- Manual submission workflow fully documented in SUBMISSION.md
- Documentation includes gotchas, tips, checklist for reproducibility
- SUBM-07: First submission to App Review completed
- SUBM-08: Manual submission workflow documented in SUBMISSION.md
</success_criteria>

<output>
After completion, create `.planning/phases/16-submission-and-distribution/16-03-SUMMARY.md`
</output>
